{"version":3,"sources":["sketch.js","App.js","index.js"],"names":["sketch","p","analyser","bufferLength","frameCount","dataArray","setup","createCanvas","windowWidth","windowHeight","windowResized","resizeCanvas","myCustomRedrawAccordingToNewPropsHandler","props","Uint8Array","fftSize","btnClick","draw","undefined","getByteTimeDomainData","console","log","background","length","textSize","fill","text","Math","floor","random","stroke","prev","sliceWidth","x","i","y","line","App","navigator","mediaDevices","getUserMedia","audio","then","micStart","micError","stream","alert","setState","style","display","context","state","microphone","createMediaStreamSource","createAnalyser","connect","frequencyBinCount","update","btnTxt","getByteFrequencyData","AudioContext","window","webkitAudioContext","timer","id","this","onClick","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.72fe4f9e.chunk.js","sourcesContent":["\nexport default function sketch (p) {\n    let analyser;\n    let frameCount = 0;\n    let dataArray = [];\n    let btnClick;\n    let button;\n    let bufferLength;\n\n\n    p.setup = () => {\n        p.createCanvas(p.windowWidth, p.windowHeight);\n        //p.frameRate(30);\n        \n    };\n\n    p.windowResized = () =>  {\n        p.resizeCanvas(p.windowWidth, p.windowHeight);\n    }\n\n    \n    p.myCustomRedrawAccordingToNewPropsHandler = (props) => {\n        if (props.dataArray) {\n            //console.log(dataArray);\n            dataArray = props.dataArray;\n        }\n        if (props.bufferLength) {\n            bufferLength = props.bufferLength;\n        }\n        if (props.analyser) {\n            if (props.analyser == null) return;\n            analyser = props.analyser;\n            dataArray = new Uint8Array(analyser.fftSize);\n        }\n        if (props.btnClick) {\n            btnClick = props.btnClick;\n            \n            if (button) button.mousePressed(btnClick);\n        }\n    };\n\n    p.draw = function () {\n        frameCount++;\n        if (frameCount % 20 === 0) {\n            if (analyser !== undefined) {\n                //getAnalysedData();\n                getTimeDomainData();\n            }\n        }\n        //if (dataArray.length > 0)\n        p.background(0, 0, 0);\n        if (dataArray.length <= 0) return;\n        // button = p.createButton('START');\n        // button.position(p.windowWidth/2, p.windowHeight/2);\n        // button.mousePressed(btnClick);\n        // button.style('background-color', p.color(255,255,255,255));\n        \n        p.textSize(30);\n        p.fill(100,100,100);\n        p.text(dataArray[Math.floor(Math.random()*100)], p.windowWidth/2, p.windowHeight/2);\n        \n        p.stroke(126);\n        p.fill(0);\n        //p.fill(p.NONE);\n        let sliceWidth = p.windowWidth * 1.0 / bufferLength;\n        let x = 0;\n        let prev;\n        for(var i = 0; i < bufferLength; i++) {\n    \n            var v = dataArray[i] / 128.0;\n            var y = v * p.windowHeight/2;\n\n            if(i !== 0) {\n                p.line(prev[0], prev[1], x, y);\n            }\n            prev = [x, y];\n\n            x += sliceWidth;\n        }\n        p.line(prev[0], prev[1], p.windowWidth, p.windowHeight/2);\n        \n    };\n\n    function getAnalysedData() {\n        console.log(\"getAnalysedData\");\n        analyser.getByteFrequencyData(dataArray);\n        console.log(dataArray);\n    }\n\n    function getTimeDomainData() {\n        analyser.getByteTimeDomainData(dataArray);\n        console.log(dataArray);\n    }\n};\n\n","import React, {Component}  from 'react';\n//import { LineChart, Line, XAxis, YAxis } from 'recharts';\n//import logo from './logo.svg';\n//import Tone from 'tone';\nimport P5Wrapper from 'react-p5-wrapper';\nimport sketch from './sketch';\nimport './App.css';\n\n\n// class App2 extends Component{\n//   //state = {};\n//   constructor() {\n//     super();\n//     this.state = {\n//       fft: new Tone.Analyser(),\n//       waveform: new Tone.Analyser('waveform', 64),\n//       mic: new Tone.UserMedia(),\n//       recordTxt: \"Record\",\n//       temp: [],\n//       fftMax: 0,\n//       waveMax: 0,\n//     };\n\n//   }\n\n//   record = () => {\n//     let {mic, recordTxt, waveform, fft} = this.state;\n//     if (recordTxt === \"Record\") {\n//       if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n//         alert(\"瀏覽器不支持 enumerateDevices() .\");\n//         return;\n//       }\n      \n//       // navigator.mediaDevices.enumerateDevices()\n//       // .then(function(devices) {\n//       //   alert('devices:');\n//       //   devices.forEach(function(device) {\n//       //     alert(device.kind + \": \" + device.label +\n//       //                 \" id = \" + device.deviceId);\n//       //   });\n//       // })\n//       // .catch(function(err) {\n//       //   alert(err.name + \": \" + err.message);\n//       // });\n      \n//       Tone.UserMedia.enumerateDevices().then(function(devices){\n//         console.log(String(devices))\n//       })\n//       mic.open().then(() => {\n//         console.log('mic open!');\n//         //alert(mic.deviceId);\n//         mic.fan(fft,waveform);\n//         this.setupPitch();\n//         this.setState({recordTxt: \"Stop\"});\n//       });\n      \n//     } else {\n//       console.log('mic close!');\n//       mic.close();\n//       this.setState({recordTxt: \"Record\"});\n//     }\n    \n    \n//   }\n\n//   setupPitch = () => {\n//     let {waveform, fft, mic} = this.state;\n\n//     // mic.toMaster();\n//     //PITCH\n//     // var pitch1 = new Tone.PitchShift().toMaster();\n//     // var pitch2 = new Tone.PitchShift().toMaster();\n//     // //Connect Mic to Pitches\n//     // mic.connect(pitch1).connect(pitch2);\n//     // //Pitch1 and Pitch together with Mic create a Major Third Chord\n//     // pitch1.pitch = 4; //one third up\n//     // pitch2.pitch = -4; //one third down\n\n//     setInterval(() => {\n//       var waveData = waveform.getValue();\n//       var max = Math.max.apply(Math, waveData);\n//       var min = Math.min.apply(Math, waveData)*-1;\n//       var r = Math.max(max, min);\n//       r *= 7;\n//       if (r < 0.1 && r !== 0) {\n//           r = 0.1;\n//       }\n\n//       var fftValue = fft.getValue();\n      \n//       //fftValue = fftValue.subarray(0, N/2 - 1);\n//       max = Math.max(...fftValue);\n//       //min = Math.min(...fftValue);\n//       //var tempMax = max > -min ? max : min;\n//       var fs = fft.context.sampleRate;\n//       var N = fft._analyser.fftSize;\n//       var fftMax = fftValue.indexOf(max) * fs / N;\n      \n//       //console.log(fft.getValue());\n//       //console.log(fft);\n//       var data = [];\n//       for (let i=0; i<fftValue.length; i++) {\n//         data.push({name: Math.floor(i * fs / N), intensity: fftValue[i]});\n//       }\n\n//       console.log(fftMax, r, this.state.mic.volume.value);\n//       this.setState((prevState) => ({\n//         temp: data, \n//         fftMax: r === 0.1 ? prevState.fftMax : Math.floor(fftMax),\n//         waveMax: (r*10).toFixed(2)\n//       }));\n\n\n//       //console.log(mic.context);\n//      //console.log(Tone.Master.volume.value);\n//     }, 200)\n//     // setTimeout(function () {\n//     //   mic.disconnect(pitch1).disconnect(pitch2);\n//     //   mic.disconnect (Tone.Master);\n//     // }, 5000);\n//   }\n\n//   render() {\n\n//     //return <MyChart />;\n//     return (\n//     <div>\n//       <button onClick={this.record}>{this.state.recordTxt}</button>\n//       {/* <MyChart data={this.state.temp}></MyChart> */}\n//       <br/><span>{this.state.fftMax} Hz</span>\n//       <br/><span>volume : {this.state.waveMax}</span>\n//     </div>\n//     );\n//   }\n\n  \n\n// }\n\n\n\nclass App extends Component {\n\n  constructor() {\n    super();\n    var AudioContext = window.AudioContext // Default\n          || window.webkitAudioContext // Safari and old versions of Chrome\n          || false; \n\n    this.state = {\n      timer: null,\n      style: {},\n      btnTxt: 'START',\n      context: AudioContext? new AudioContext() : null,\n    }\n    \n  }\n  \n\n  // componentDidMount() {\n    \n  // }\n\n  btnClick = () => {\n    navigator.mediaDevices.getUserMedia({audio: true})\n        .then(this.micStart, this.micError);\n  }\n\n  micStart = (stream) => {\n    alert('here');\n    this.setState({style:{display:'none'}});\n    let {context} = this.state;\n    var microphone = context.createMediaStreamSource(stream);\n    var analyser = context.createAnalyser();\n    microphone.connect(analyser);\n    //analyser.connect(context.destination);\n    analyser.fftSize = 2048;\n    var bufferLength = analyser.frequencyBinCount;\n    var dataArray = new Uint8Array(analyser.fftSize);\n\n    this.setState ({\n      analyser : analyser,\n      dataArray: dataArray,\n      bufferLength: bufferLength,\n      \n    });\n    this.update();\n  }\n\n  micError = () => {\n    this.setState({btnTxt:'RE-EANBLE!'});\n    console.log('error');\n  }\n\n  update = () => {\n    let {dataArray, analyser} = this.state;\n    console.log(dataArray);\n    analyser.getByteFrequencyData(dataArray);\n    //this.setState({timer:setTimeout(this.update,200)});\n  }\n\n  render() {\n\n    return (\n      <div>\n        <div id=\"wrap\" style={this.state.style}>\n          <button onClick={this.btnClick}>{this.state.btnTxt}</button>\n        </div>\n        <P5Wrapper sketch={sketch} analyser={this.state.analyser} \n           bufferLength={this.state.bufferLength}/>\n      </div>\n    );\n  }\n}\n\n// function App() {\n  \n//   return (\n//     <div/>\n//   );\n// }\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n//import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}